{% extends "layout.html" %}
{% block main %}
    <div class="form-container">
        <h3>Employees</h3>
        <!-- <form id="form" action="/viewTasks/" method="post" enctype="multipart/form-data">
        <div class="form-group-inline">
            {% csrf_token %}
            <div class="form-item">
                <label for="project">Project:</label>
                <select name="project" class="project">
                    <option value="">Select a Project</option>
                    {% for key, value in projects.items %}
                        <option value="{{ key }}">{{ value }}</option>
                    {% endfor %}
                </select>
            </div>
            <div class="form-item">
                <label for="date">Date:</label>
                <input type="date" id="date" name="date" >
            </div>
            <div class="form-item button-item">
                <button type="submit">Apply Filter</button>
            </div>
    </div>
    </form> -->
        {% if users %}
            <table>
                <thead>
                <tr>
                    <th>Employee Id</th>
                    <th>Employee Name</th>
                    <th>Role</th>
                    <th>Functions</th>
                </tr>
                </thead>
                <tbody>
                {% for user in users %}
                    <tr>
                        <td>{{ user.id }}</td>
                        <td>{{ user.first_name }} {{ user.last_name }}</td>
                        {% if user.role == 'SA' %}
                            <td>Sysem Administrator</td>
                        {% elif user.role == 'PM' %}
                            <td>Project Manager</td>
                        {% else %}
                            <td>Project Member</td>
                        {% endif %}
                        <td>
                            <button onclick="onclicking(event,{{ user.id }})"><i class="fa fa-eye"
                                                                                 style="font-size:24px"></i></button>
                            <button style="background-color: red;margin-left: 3px;"
                                    onclick="deleteUser(event,{{ user.id }})"><i class="fa fa-trash" aria-hidden="true"
                                                                                 style="font-size:24px;"></i></button>
                        </td>
                    </tr>
                {% endfor %}
                </tbody>
            </table>
        {% else %}
            <p><b>No Users</b></p>
        {% endif %}
    </div>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
        function deleteUser(event, userId) {
            deleteUserElement = document.getElementById("deleteUser")
            deleteUserElement.innerHTML = `
         <p>Are you sure you want to delete the User</p>
        `
            $(`#deleteModal`).modal(`show`)
            document.getElementById("yes").addEventListener("click", async function () {
                try {
                    const response = await axios.get(`/deleteUser/${userId}`)
                    window.location.reload()
                } catch (error) {
                    alert(error);
                }
            })
        }
    </script>
    <script>
        const date = new Date()
        const dd = String(date.getDate()).padStart(2, "0")
        const mm = String(date.getMonth() + 1).padStart(2, "0")
        const yyyy = String(date.getFullYear())
        const dateElement = document.getElementById("date")
        dateElement.setAttribute("max", yyyy + "-" + mm + "-" + dd)

        async function onclicking(event, userId) {
            try {
                event.preventDefault();
                let response = await axios.get(`/viewUser/${userId}`);
                taskelement = document.getElementById("myTask");

                taskelement.innerHTML = `
                <h4>User Name :</h4>
                <p>${response["data"]["username"]}</p>
                <br>
                <h4>Email</h4>
                <p>${response["data"]["email"]}</p>
                <br>
                <h4>Role</h4>
                <p>${response["data"]["role"]}</p>
                <br>
                <h4>Password</h4>
                <p style="overflow-x: scroll">${response["data"]["password"]}...</p>
                <br>
            `
                $(`#exampleModalLong`).modal(`show`)
            } catch (error) {
                console.log(error)
            }
        }
    </script>
{% endblock %}
